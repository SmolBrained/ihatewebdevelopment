<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://i.imgur.com/WPy5YDY.png">
    <title>News | Literary Speaking</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function(OneSignal) {
        await OneSignal.init({
          appId: "d12debe4-4f24-4db4-bfa5-9f6ee5f38d48",
        });
      });
    </script>
    <style>
        .hero-banner{height:60vh;min-height:400px;display:flex;align-items:center;justify-content:center;color:#fff;text-align:center;position:relative;padding:0 20px;background-attachment:fixed;background-position:center;background-repeat:no-repeat;background-size:cover}
        .hero-banner .overlay{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);z-index:2}
        .hero-banner .content{position:relative;z-index:3}
        .hero-banner h1{font-size:3.8rem;font-weight:900;margin:0;line-height:1.2}
        
        .news-container { text-align: left; }
        .featured-section { padding-bottom: 30px; }
        .section-divider { border: 0; border-top: 1px solid #000; margin: 0; }

        .featured-item { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; align-items: center; padding: 30px 0; border-bottom: 1px solid #ddd; text-decoration: none; color: inherit; cursor: pointer; }
        .featured-item:first-child { padding-top: 20px; }
        .featured-item-content .author { font-size: 0.75rem; font-weight: 700; text-transform: uppercase; color: var(--color-text-muted); margin: 0 0 10px; }
        .featured-item-content .title { font-size: 1.8rem; font-weight: 900; margin: 0 0 10px; line-height: 1.2; transition: color 0.3s ease; }
        .featured-item:hover .title { color: var(--color-purple-dark); }
        .featured-item-content .meta { font-size: 0.8rem; font-weight: 700; color: var(--color-text-muted); text-transform: uppercase; }
        .featured-item-image { width: 100%; aspect-ratio: 16/10; object-fit: cover; border-radius: 8px; }
        .featured-item.with-image .author, .featured-item.with-image .title, .featured-item.with-image .meta { grid-column: 1; }
        .featured-item.no-image .featured-item-content { grid-column: 1 / -1; }
        
        .standard-news-grid { display: grid; grid-template-columns: 1fr 1fr; padding-top: 30px; }
        .standard-news-item { padding: 0 25px 25px 0; text-decoration: none; color: inherit; cursor: pointer; }
        .standard-news-item.horizontal { grid-column: 1 / -1; display: flex; gap: 25px; align-items: center; padding-right: 0; border-bottom: 1px solid #ddd; padding-bottom: 25px; margin-bottom: 25px; }
        .standard-news-item.grid-item { border-bottom: 1px solid #ddd; }
        .standard-news-item.grid-item:nth-child(2n) { padding-right: 0; }
        .standard-news-item.grid-item:nth-child(2n+1) { border-right: 1px solid #ddd; }
        
        .standard-news-item .author { font-size: 0.75rem; font-weight: 700; text-transform: uppercase; color: var(--color-text-muted); margin: 0 0 10px; }
        .standard-news-item .title { font-size: 1.3rem; font-weight: 900; margin: 0 0 10px; line-height: 1.3; transition: color 0.3s ease; }
        .standard-news-item:hover .title { color: var(--color-purple-dark); }
        .standard-news-item .meta { font-size: 0.8rem; font-weight: 700; color: var(--color-text-muted); text-transform: uppercase; }
        .standard-news-item.horizontal .image-container { flex-shrink: 0; width: 300px; }
        .standard-news-item.horizontal .image-container img { width: 100%; aspect-ratio: 16/10; object-fit: cover; border-radius: 8px; }
        .standard-news-item.horizontal .content { flex-grow: 1; }

        .social-section{background-color:var(--color-pink); padding: 80px 0;}
        .social-box{background-color:#fff0f5;padding:50px;border-radius:16px;box-shadow:0 15px 30px rgba(0,0,0,0.1);color:var(--color-purple-dark)}
        .social-box .section-title, .social-box .section-subtitle{color:var(--color-purple-dark)}
        .social-box .section-subtitle a{color:var(--color-purple-dark);font-weight:700}

        @media (max-width: 900px) { 
            .featured-item { grid-template-columns: 1fr; }
            .featured-item-image { grid-row: 1; margin-bottom: 20px; }
            .standard-news-grid { grid-template-columns: 1fr; }
            .standard-news-item.grid-item:nth-child(2n+1) { border-right: none; padding-right: 0; }
            .standard-news-item.horizontal { flex-direction: column; align-items: flex-start; }
            .standard-news-item.horizontal .image-container { width: 100%; margin-bottom: 15px; }
        }
        @media (max-width: 768px) {
            .hero-banner{background-attachment:scroll;}
            .hero-banner h1{font-size:2.2rem;}
            .featured-item .title { font-size: 1.5rem; }
            .social-box{padding:30px}
        }
    </style>
</head>
<body data-current-page="news">
    <header class="site-header" id="header"></header>
    <main>
        <section class="hero-banner" style="background-image: url(https://i.imgur.com/p6BgTSq.png);">
            <div class="overlay"></div>
            <div class="content scroll-animated">
                <h1 class="lang-switch" data-en="News" data-es="Noticias"></h1>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <div id="news-container" class="news-container"></div>
            </div>
        </section>
        
        <section class="section social-section">
            <div class="container scroll-animated">
                <div class="social-box">
                    <h2 class="section-title lang-switch" data-en="Social Media" data-es="Redes Sociales"></h2>
                    <p class="section-subtitle">Follow us <a href="https://www.instagram.com/literaryspeakingtutoring/" target="_blank" rel="noopener noreferrer">@literaryspeakingtutoring</a></p>
                    <div id="curator-feed-default-feed-layout"><a href="https://curator.io/" target="_blank" class="crt-logo crt-tag">Powered by Curator.io</a></div>
                </div>
            </div>
        </section>
    </main>
    <footer class="site-footer"></footer>
    <script src="router.js"></script>
    <script type="text/javascript">
    (function(){
    var i,e,d=document,s="script";i=d.createElement("script");i.async=1;i.charset="UTF-8";
    i.src="https://cdn.curator.io/published/ecfc6731-dd7d-4877-bdc8-6e38d9fc2813.js";
    e=d.getElementsByTagName(s)[0];e.parentNode.insertBefore(i, e);
    })();
    </script>
    <script type="module">
        import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD0qVihpuLI0cF0PZ32o8tFBLfTgjlqB6A",
            authDomain: "literary-speaking.firebaseapp.com",
            projectId: "literary-speaking",
            storageBucket: "literary-speaking.appspot.com",
            messagingSenderId: "699059463612",
            appId: "1:699059463612:web:ecb2e784d627c6b93937b9",
            measurementId: "G-0L1V3XXGGR"
        };
        
        if (!getApps().length) {
            initializeApp(firebaseConfig);
        }
        const db = getFirestore();

        document.addEventListener('DOMContentLoaded', async () => {
            let allNewsItems = [];
            
            try {
                await siteRouter.loadMembers();
                const newsQuery = query(collection(db, "news"), orderBy("date", "desc"));
                const querySnapshot = await getDocs(newsQuery);
                allNewsItems = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })).filter(item => item.isPublished === true);
            } catch (error) {
                console.error("Failed to load news items:", error);
                const newsContainer = document.getElementById('news-container');
                if(newsContainer) newsContainer.innerHTML = `<p>Could not load news. Please try again later.</p>`;
            }
            
            const featuredItems = allNewsItems.filter(item => item.isFeatured);
            const nonFeaturedItems = allNewsItems.filter(item => !item.isFeatured);

            const newsContainer = document.getElementById('news-container');

            const populateNews = (lang) => {
                if (!newsContainer) return;
                newsContainer.innerHTML = '';

                if (allNewsItems.length === 0) {
                    const emptyMessage = lang === 'es' ? "Aún no hay noticias. ¡Vuelve pronto!" : "No news items yet. Check back soon!";
                    newsContainer.innerHTML = `<p>${emptyMessage}</p>`;
                    return;
                }

                let featuredHTML = '';
                if (featuredItems.length > 0) {
                    featuredHTML = '<div class="featured-section">';
                    featuredItems.forEach(item => {
                        const author = siteRouter.members[item.author_id] || { name: 'Anonymous' };
                        const hasImage = item.thumbnail_url;
                        featuredHTML += `
                            <div class="featured-item ${hasImage ? 'with-image' : 'no-image'}" data-id="${item.id}">
                                <div class="featured-item-content">
                                    <p class="author">${author.name}</p>
                                    <h3 class="title">${item[`title_${lang}`] || item.title_en}</h3>
                                    <p class="meta">${item[`read_time_${lang}`] || item.read_time_en}</p>
                                </div>
                                ${hasImage ? `<img src="${item.thumbnail_url}" alt="" class="featured-item-image">` : ''}
                            </div>
                        `;
                    });
                    featuredHTML += '</div>';
                }

                let nonFeaturedHTML = '';
                if (nonFeaturedItems.length > 0) {
                    nonFeaturedHTML = '<div class="standard-news-grid">';
                    nonFeaturedItems.forEach((item, index) => {
                        const author = siteRouter.members[item.author_id] || { name: 'Anonymous' };
                        const patternIndex = index % 6;
                        
                        if (patternIndex < 2) { // Horizontal items
                            const hasImage = item.thumbnail_url;
                            nonFeaturedHTML += `
                                <div class="standard-news-item horizontal" data-id="${item.id}">
                                    ${hasImage ? `<div class="image-container"><img src="${item.thumbnail_url}" alt=""></div>` : ''}
                                    <div class="content">
                                        <p class="author">${author.name}</p>
                                        <h4 class="title">${item[`title_${lang}`] || item.title_en}</h4>
                                        <p class="meta">${item[`read_time_${lang}`] || item.read_time_en}</p>
                                    </div>
                                </div>
                            `;
                        } else { // Grid items
                            nonFeaturedHTML += `
                                <div class="standard-news-item grid-item" data-id="${item.id}">
                                    <p class="author">${author.name}</p>
                                    <h4 class="title">${item[`title_${lang}`] || item.title_en}</h4>
                                    <p class="meta">${item[`read_time_${lang}`] || item.read_time_en}</p>
                                </div>
                            `;
                        }
                    });
                    nonFeaturedHTML += '</div>';
                }
                
                newsContainer.innerHTML = featuredHTML;
                if (featuredItems.length > 0 && nonFeaturedItems.length > 0) {
                    newsContainer.innerHTML += '<hr class="section-divider">';
                }
                newsContainer.innerHTML += nonFeaturedHTML;

                newsContainer.querySelectorAll('[data-id]').forEach(element => {
                    element.addEventListener('click', () => {
                        siteRouter.navigateTo('news-single', element.dataset.id);
                    });
                });
            };

            const initialLang = localStorage.getItem('language') || 'en';
            populateNews(initialLang);

            document.addEventListener('languageChanged', (e) => {
                populateNews(e.detail.lang);
            });

            const animationObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        animationObserver.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('main .scroll-animated').forEach(el => {
                animationObserver.observe(el);
            });
        });
    </script>
</body>
</html>
