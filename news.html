<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://i.imgur.com/WPy5YDY.png">
    <title>News | Literary Speaking</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
      window.OneSignalDeferred = window.OneSignalDeferred || [];
      OneSignalDeferred.push(async function(OneSignal) {
        await OneSignal.init({
          appId: "d12debe4-4f24-4db4-bfa5-9f6ee5f38d48",
        });
      });
    </script>
    <style>
        .hero-banner{height:60vh;min-height:400px;display:flex;align-items:center;justify-content:center;color:#fff;text-align:center;position:relative;padding:0 20px;background-attachment:fixed;background-position:center;background-repeat:no-repeat;background-size:cover}
        .hero-banner .overlay{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);z-index:2}
        .hero-banner .content{position:relative;z-index:3}
        .hero-banner h1{font-size:3.5rem;font-weight:900;margin:0;line-height:1.2}
        
        .news-layout { display: flex; gap: 30px; position: relative; }
        .featured-column { flex: 1.5; min-width: 0; text-align: left; }
        .not-featured-column { flex: 1; min-width: 0; position: relative; padding-left: 30px; }
        .not-featured-column::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            width: 1px;
            background-color: #ddd;
        }

        .featured-item { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; align-items: center; padding: 25px 0; border-bottom: 1px solid #ddd; text-decoration: none; color: inherit; cursor: pointer;}
        .featured-item:first-child { border-top: 1px solid #ddd; }
        .featured-item-title { font-size: 1.6rem; font-weight: 900; margin: 0 0 8px; line-height: 1.2; transition: color 0.3s ease; }
        .featured-item:hover .featured-item-title { color: var(--color-purple-dark); }
        .featured-item-excerpt { font-size: 0.95rem; line-height: 1.6; color: var(--color-text-light); margin: 0 0 8px; }
        .featured-item-meta { font-size: 0.75rem; font-weight: 700; color: var(--color-text-muted); text-transform: uppercase; }
        .featured-item-image { width: 100%; aspect-ratio: 16/10; object-fit: cover; border-radius: 8px; }

        .nf-item { padding: 18px 0; border-bottom: 1px solid #ddd; text-decoration: none; color: inherit; cursor: pointer; text-align: left; }
        .nf-item:hover .nf-item-title { color: var(--color-purple-dark); }
        .nf-item-author { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; color: var(--color-text-muted); margin: 0 0 8px; }
        .nf-item-title { font-size: 1.1rem; font-weight: 900; margin: 0 0 8px; line-height: 1.3; }
        .nf-item-meta { font-size: 0.75rem; font-weight: 700; color: var(--color-text-muted); text-transform: uppercase; }
        .nf-item-excerpt { font-size: 0.9rem; line-height: 1.6; color: var(--color-text-light); margin: 8px 0; }
        .nf-item-image { width: 100%; display: block; margin-bottom: 12px; border-radius: 4px; }
        
        .nf-item--large-thumb .nf-item-title { font-size: 1.3rem; }
        .nf-item--large-thumb .nf-item-excerpt { font-size: 0.95rem; }

        .nf-layout-container { padding: 18px 0; border-bottom: 1px solid #ddd; }
        .nf-layout-container--grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        .nf-layout-container--grid .nf-item { padding: 0; border-bottom: none; }
        .nf-layout-container--grid .nf-item:nth-child(1), .nf-layout-container--grid .nf-item:nth-child(2) { padding-bottom: 18px; border-bottom: 1px solid #ddd; }
        
        .nf-layout-container--side-by-side { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        .nf-layout-container--side-by-side .nf-item { padding: 0; border-bottom: none; position: relative; }
        .nf-layout-container--side-by-side .nf-item:first-child::after { content: ''; position: absolute; top: 0; bottom: 0; right: -12.5px; width: 1px; background-color: #ddd; }
        .nf-layout-container--side-by-side .nf-item-title { font-size: 1rem; }

        .nf-item--thumb-right { display: flex; justify-content: space-between; align-items: flex-start; }
        .nf-item--thumb-right .nf-item-content { flex: 1; }
        .nf-item--thumb-right .nf-item-image { width: 100px; height: 100px; object-fit: cover; margin-left: 20px; flex-shrink: 0; }
        .nf-item--thumb-right .nf-item-title { font-size: 1rem; }

        .social-section{background-color:var(--color-pink); padding: 80px 0;}
        .social-box{background-color:#fff0f5;padding:50px;border-radius:16px;box-shadow:0 15px 30px rgba(0,0,0,0.1);color:var(--color-purple-dark)}
        .social-box .section-title, .social-box .section-subtitle{color:var(--color-purple-dark)}
        .social-box .section-subtitle a{color:var(--color-purple-dark);font-weight:700}

        @media (max-width: 900px) { 
            .news-layout { flex-direction: column; } 
            .not-featured-column { padding-left: 0; }
            .not-featured-column::before { display: none; }
        }
        @media (max-width: 768px) {
            .hero-banner{background-attachment:scroll;}
            .hero-banner h1{font-size:2.2rem;}
            .featured-item { grid-template-columns: 1fr; }
            .featured-item-image { grid-row: 1; margin-bottom: 20px; }
            .featured-item-title { font-size: 1.5rem; }
            .nf-layout-container--grid, .nf-layout-container--side-by-side { grid-template-columns: 1fr; }
            .nf-layout-container--grid .nf-item { padding-bottom: 18px; border-bottom: 1px solid #ddd; }
            .nf-layout-container--grid .nf-item:last-child, .nf-layout-container--grid .nf-item:nth-child(2) { border-bottom: none; }
            .nf-layout-container--side-by-side .nf-item:first-child::after { display: none; }
            .nf-layout-container--side-by-side .nf-item:first-child { padding-bottom: 18px; border-bottom: 1px solid #ddd; }
            .social-box{padding:30px}
        }
    </style>
</head>
<body data-current-page="news">
    <header class="site-header" id="header"></header>
    <main>
        <section class="hero-banner" style="background-image: url(https://i.imgur.com/p6BgTSq.png);">
            <div class="overlay"></div>
            <div class="content scroll-animated">
                <h1 class="lang-switch" data-en="News" data-es="Noticias"></h1>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <div id="news-layout" class="news-layout">
                    <div id="featured-column" class="featured-column"></div>
                    <div id="not-featured-column" class="not-featured-column"></div>
                </div>
            </div>
        </section>
        
        <section class="section social-section">
            <div class="container scroll-animated">
                <div class="social-box">
                    <h2 class="section-title lang-switch" data-en="Social Media" data-es="Redes Sociales"></h2>
                    <p class="section-subtitle">Follow us <a href="https://www.instagram.com/literaryspeakingtutoring/" target="_blank" rel="noopener noreferrer">@literaryspeakingtutoring</a></p>
                    <div id="curator-feed-default-feed-layout"><a href="https://curator.io/" target="_blank" class="crt-logo crt-tag">Powered by Curator.io</a></div>
                </div>
            </div>
        </section>
    </main>
    <footer class="site-footer"></footer>
    <script src="router.js"></script>
    <script type="text/javascript">
    (function(){
    var i,e,d=document,s="script";i=d.createElement("script");i.async=1;i.charset="UTF-8";
    i.src="https://cdn.curator.io/published/ecfc6731-dd7d-4877-bdc8-6e38d9fc2813.js";
    e=d.getElementsByTagName(s)[0];e.parentNode.insertBefore(i, e);
    })();
    </script>
    <script type="module">
        import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD0qVihpuLI0cF0PZ32o8tFBLfTgjlqB6A",
            authDomain: "literary-speaking.firebaseapp.com",
            projectId: "literary-speaking",
            storageBucket: "literary-speaking.appspot.com",
            messagingSenderId: "699059463612",
            appId: "1:699059463612:web:ecb2e784d627c6b93937b9",
            measurementId: "G-0L1V3XXGGR"
        };
        
        if (!getApps().length) {
            initializeApp(firebaseConfig);
        }
        const db = getFirestore();

        const createNewsElement = (item, lang, template) => {
            const author = siteRouter.members[item.author_id] || { name: 'Literary Speaking' };
            const el = document.createElement('div');
            el.className = `nf-item ${template}`;
            
            const titleHTML = `<h3 class="nf-item-title">${item[`title_${lang}`] || item.title_en}</h3>`;
            const authorHTML = `<p class="nf-item-author">${author.name}</p>`;
            const metaHTML = `<p class="nf-item-meta">${item[`read_time_${lang}`] || item.read_time_en}</p>`;
            const excerptHTML = `<p class="nf-item-excerpt">${item[`excerpt_${lang}`] || item.excerpt_en}</p>`;
            const imageHTML = `<img src="${item.thumbnail_url || 'https://i.imgur.com/3Yj6bA1.png'}" alt="" class="nf-item-image">`;

            switch (template) {
                case 'nf-item--large-thumb':
                    el.innerHTML = `${imageHTML}${authorHTML}${titleHTML}${excerptHTML}${metaHTML}`;
                    break;
                case 'nf-item--side-by-side-item':
                    el.innerHTML = `${imageHTML}${authorHTML}${titleHTML}${metaHTML}`;
                    break;
                case 'nf-item--grid-item':
                    el.innerHTML = `${authorHTML}${titleHTML}${metaHTML}`;
                    break;
                case 'nf-item--thumb-right':
                    el.innerHTML = `<div class="nf-item-content">${authorHTML}${titleHTML}${metaHTML}</div>${imageHTML}`;
                    break;
                case 'nf-item--horizontal':
                default:
                    el.innerHTML = `${authorHTML}${titleHTML}${metaHTML}`;
                    break;
            }
            el.addEventListener('click', () => siteRouter.navigateTo('news-single', item.id));
            return el;
        };

        document.addEventListener('DOMContentLoaded', async () => {
            let allNewsItems = [];
            
            try {
                await siteRouter.loadMembers();
                const newsQuery = query(collection(db, "news"), orderBy("date", "desc"));
                const querySnapshot = await getDocs(newsQuery);
                allNewsItems = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })).filter(item => item.isPublished === true);
            } catch (error) {
                console.error("Failed to load news items:", error);
                const featuredColumn = document.getElementById('featured-column');
                if(featuredColumn) featuredColumn.innerHTML = `<p>Could not load news. Please try again later.</p>`;
            }
            
            const featuredItems = allNewsItems.filter(item => item.isFeatured);
            let notFeaturedItems = allNewsItems.filter(item => !item.isFeatured);

            const featuredColumn = document.getElementById('featured-column');
            const notFeaturedColumn = document.getElementById('not-featured-column');

            const populateColumns = (lang) => {
                if (!featuredColumn || !notFeaturedColumn) return;

                featuredColumn.innerHTML = '';
                notFeaturedColumn.innerHTML = '';

                if (allNewsItems.length === 0) {
                    const emptyMessage = lang === 'es' ? "Aún no hay noticias. ¡Vuelve pronto!" : "No news items yet. Check back soon!";
                    featuredColumn.innerHTML = `<p>${emptyMessage}</p>`;
                    return;
                }
                
                featuredItems.forEach(item => {
                    const link = document.createElement('div');
                    link.className = 'featured-item';
                    link.innerHTML = `
                        <div class="featured-item-content">
                            <h3 class="featured-item-title">${item[`title_${lang}`] || item.title_en}</h3>
                            <p class="featured-item-excerpt">${item[`excerpt_${lang}`] || item.excerpt_en}</p>
                            <p class="featured-item-meta">${item[`read_time_${lang}`] || item.read_time_en}</p>
                        </div>
                        <img src="${item.thumbnail_url || 'https://i.imgur.com/3Yj6bA1.png'}" alt="" class="featured-item-image">
                    `;
                    link.addEventListener('click', () => siteRouter.navigateTo('news-single', item.id));
                    featuredColumn.appendChild(link);
                });

                let remainingItems = [...notFeaturedItems];
                if (remainingItems.length > 0) {
                    const firstItem = remainingItems.shift();
                    notFeaturedColumn.appendChild(createNewsElement(firstItem, lang, 'nf-item--large-thumb'));
                }

                const layoutPattern = ['horizontal', 'horizontal', 'side-by-side', 'horizontal', 'horizontal', 'grid', 'horizontal', 'horizontal', 'thumb-right', 'thumb-right', 'thumb-right'];
                let patternIndex = 0;
                let i = 0;
                while (i < remainingItems.length) {
                    const patternType = layoutPattern[patternIndex % layoutPattern.length];
                    
                    switch (patternType) {
                        case 'horizontal':
                             if (remainingItems.length - i >= 1) {
                                notFeaturedColumn.appendChild(createNewsElement(remainingItems[i], lang, 'nf-item--horizontal'));
                                i++;
                            } else { i = remainingItems.length; }
                            break;
                        case 'grid':
                            if (remainingItems.length - i >= 4) {
                                const container = document.createElement('div');
                                container.className = 'nf-layout-container nf-layout-container--grid';
                                for(let j = 0; j < 4; j++) {
                                    container.appendChild(createNewsElement(remainingItems[i + j], lang, 'nf-item--grid-item'));
                                }
                                notFeaturedColumn.appendChild(container);
                                i += 4;
                            } else { i = remainingItems.length; }
                            break;
                        case 'side-by-side':
                             if (remainingItems.length - i >= 2) {
                                const container = document.createElement('div');
                                container.className = 'nf-layout-container nf-layout-container--side-by-side';
                                for(let j = 0; j < 2; j++) {
                                    container.appendChild(createNewsElement(remainingItems[i + j], lang, 'nf-item--side-by-side-item'));
                                }
                                notFeaturedColumn.appendChild(container);
                                i += 2;
                            } else { i = remainingItems.length; }
                            break;
                        case 'thumb-right':
                            if (remainingItems.length - i >= 1) {
                                notFeaturedColumn.appendChild(createNewsElement(remainingItems[i], lang, 'nf-item--thumb-right'));
                                i++;
                            } else { i = remainingItems.length; }
                            break;
                        default:
                            i++;
                            break;
                    }
                    patternIndex++;
                }
            };

            const initialLang = localStorage.getItem('language') || 'en';
            populateColumns(initialLang);

            document.addEventListener('languageChanged', (e) => {
                populateColumns(e.detail.lang);
            });

            const animationObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        animationObserver.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('main .scroll-animated').forEach(el => {
                animationObserver.observe(el);
            });
        });
    </script>
</body>
</html>
